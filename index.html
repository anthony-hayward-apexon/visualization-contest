<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visualization Contest Voting App</title>
  <!-- React and ReactDOM -->
  <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  
  <!-- Babel for JSX transpilation -->
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  
  <!-- PapaParse for CSV parsing -->
  <script src="https://unpkg.com/papaparse@5.3.0/papaparse.min.js"></script>
  
  <!-- Tailwind CSS for styling -->
  <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
  
  <style>
    /* Add any custom styles here */
    .loading-spinner {
      border-top-color: #3498db;
      -webkit-animation: spinner 1.5s linear infinite;
      animation: spinner 1.5s linear infinite;
    }
    
    @-webkit-keyframes spinner {
      0% { -webkit-transform: rotate(0deg); }
      100% { -webkit-transform: rotate(360deg); }
    }
    
    @keyframes spinner {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gray-100">
  <div id="root"></div>
  
  <!-- Application Script -->
  <script type="text/babel">
    // React component for visualization contest voting
    const VotingApp = () => {
      // State for storing submissions and application state
      const [submissions, setSubmissions] = React.useState([]);
      const [isLoading, setIsLoading] = React.useState(true);
      const [isAdmin, setIsAdmin] = React.useState(false);
      const [appInitialized, setAppInitialized] = React.useState(false);
      const [currentJudge, setCurrentJudge] = React.useState(null);
      const [view, setView] = React.useState(null); // admin, login, judging, results
      const [activeSubmissionId, setActiveSubmissionId] = React.useState(null);
      const [iframeLoading, setIframeLoading] = React.useState(true);
      const [tempScores, setTempScores] = React.useState({});
      const [sharingLink, setSharingLink] = React.useState('');
      const [adminLink, setAdminLink] = React.useState('');
      
      // Judging categories with maximum points
      const categories = [
        { id: 'interpretability', name: 'Interpretability', maxPoints: 3, description: 'How easily and quickly you can make conclusions from the viz' },
        { id: 'creativity', name: 'Creativity', maxPoints: 2, description: 'How creative and unique is the submission?' },
        { id: 'visualDesign', name: 'Visual Design', maxPoints: 3, description: 'How well is the data visualization design, including colors, images, layout, etc?' },
        { id: 'story', name: 'Story', maxPoints: 2, description: 'How well does the viz tell a story of its own?' }
      ];

      const totalPossiblePoints = categories.reduce((sum, cat) => sum + cat.maxPoints, 0);

      // Updated with the actual judge names
      const [judges, setJudges] = React.useState([
        { id: 1, name: "Kelsey", scores: {} },
        { id: 2, name: "Bhavya", scores: {} },
        { id: 3, name: "Puneet", scores: {} },
        { id: 4, name: "Sree", scores: {} },
        { id: 5, name: "Anthony", scores: {} }
      ]);
      
      // Load data from localStorage on component mount
      React.useEffect(() => {
        const loadFromStorage = () => {
          setIsLoading(true);
          
          try {
            // Check if the app has been initialized with data
            const storedData = localStorage.getItem('vizContestData');
            
            if (storedData) {
              const parsedData = JSON.parse(storedData);
              setSubmissions(parsedData.submissions || []);
              if (parsedData.judges) {
                setJudges(parsedData.judges);
              }
              setAppInitialized(true);
            } else {
              // App not initialized yet
              setAppInitialized(false);
              loadSampleData(); // Load sample data for display purposes
            }
          } catch (error) {
            console.error("Error loading from localStorage:", error);
            loadSampleData();
          } finally {
            setIsLoading(false);
          }
        };
        
        const loadSampleData = () => {
          // Sample data as fallback
          setSubmissions([
            {
              id: 1,
              number: "Submission #1",
              medium: "Interactive Web Dashboard",
              description: "This visualization uses D3.js to create an interactive dashboard analyzing climate data patterns.",
              link: "https://example.com/submission1",
              scores: {}
            },
            {
              id: 2,
              number: "Submission #2",
              medium: "Static Infographic",
              description: "A static infographic created in Adobe Illustrator that visualizes global migration patterns.",
              link: "https://example.com/submission2",
              scores: {}
            },
            {
              id: 3,
              number: "Submission #3",
              medium: "Data Art Installation",
              description: "This physical installation translates economic inequality data into a three-dimensional representation.",
              link: "https://example.com/submission3",
              scores: {}
            },
            {
              id: 4, 
              number: "Submission #4",
              medium: "Animated Data Visualization",
              description: "An animated visualization created with Processing that shows the evolution of transportation networks.",
              link: "https://example.com/submission4",
              scores: {}
            },
            {
              id: 5,
              number: "Submission #5",
              medium: "Interactive Web Map",
              description: "An interactive choropleth map built with Leaflet.js that visualizes health outcomes across different demographics.",
              link: "https://example.com/submission5",
              scores: {}
            },
          ]);
        };
        
        // Check URL parameters for admin code
        const checkAdminStatus = () => {
          const urlParams = new URLSearchParams(window.location.search);
          const adminCode = urlParams.get('admin');
          
          // Simple admin authentication - in a real app, use better security
          if (adminCode === 'setupadmin') {
            setIsAdmin(true);
          }
        };
        
        checkAdminStatus();
        loadFromStorage();
      }, []);
      
      // Set the initial view once loading is complete
      React.useEffect(() => {
        if (!isLoading) {
          if (isAdmin) {
            setView('admin');
          } else if (appInitialized) {
            setView('login');
          } else {
            setView('admin');
          }
        }
      }, [isLoading, isAdmin, appInitialized]);
      
      // Save application state to localStorage whenever submissions or judges change
      React.useEffect(() => {
        if (submissions.length > 0 && appInitialized) {
          try {
            localStorage.setItem('vizContestData', JSON.stringify({
              submissions,
              judges,
              lastUpdated: new Date().toISOString()
            }));
          } catch (error) {
            console.error("Error saving to localStorage:", error);
          }
        }
      }, [submissions, judges, appInitialized]);
      
      // File upload functionality
      const handleFileUpload = (event) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const content = e.target.result;
            parseSubmissionsFromCSV(content);
          };
          reader.readAsText(file);
        }
      };
      
      // Parse CSV and initialize the application
      const parseSubmissionsFromCSV = (csvContent) => {
        // Use Papa Parse to parse the CSV
        const parsed = Papa.parse(csvContent, { header: true, skipEmptyLines: true });
        
        if (parsed.data && parsed.data.length > 0) {
          // Map the CSV data to the format needed by the application
          const formattedSubmissions = parsed.data.map((row, index) => ({
            id: index + 1,
            number: row['Submission #'] || `Submission #${index + 1}`,
            medium: row['Please indicate the medium(s) of your submission'] || 'Unknown',
            description: row['Tell us a bit more about your entry including details about the visualization, the techniques you used, the reasoning behind your design choices, and the potential insights that are revealed through the visualization. (250 word max)'] || 'No description provided',
            link: row['Please provide a link or attachment for your visualization.'] || '',
            scores: {}
          }));
          
          setSubmissions(formattedSubmissions);
          setAppInitialized(true);
          
          // Save to localStorage right away
          localStorage.setItem('vizContestData', JSON.stringify({
            submissions: formattedSubmissions,
            judges,
            lastUpdated: new Date().toISOString()
          }));
          
          // Show success message with sharing info
          generateSharingLinks();
        } else {
          console.error("No data found in CSV or parsing error");
          alert("Error parsing CSV file. Please check the format.");
        }
      };
      
      // Share links generation
      const generateSharingLinks = () => {
        // Generate base URL without any parameters
        const baseUrl = window.location.href.split('?')[0];
        
        // Create sharing link for judges
        setSharingLink(baseUrl);
        
        // Create admin link
        setAdminLink(`${baseUrl}?admin=setupadmin`);
      };
      
      // Reset application data (admin function)
      const resetAppData = () => {
        if (confirm("Are you sure you want to reset all application data? This will delete all submissions and scores.")) {
          localStorage.removeItem('vizContestData');
          setSubmissions([]);
          setAppInitialized(false);
          alert("Application data has been reset.");
        }
      };
      
      // Calculate total scores for each submission
      const calculateResults = () => {
        const results = submissions.map(submission => {
          let totalScore = 0;
          let scoresByJudge = {};
          let categoryTotals = {};
          let judgeCount = 0;
          
          categories.forEach(category => {
            categoryTotals[category.id] = 0;
          });

          judges.forEach(judge => {
            const judgeSubmissionKey = `${judge.id}-${submission.id}`;
            let judgeTotal = 0;
            let hasScored = false;
            
            // First check the submission's scores object
            if (submission.scores && submission.scores[judgeSubmissionKey]) {
              hasScored = true;
              categories.forEach(category => {
                const score = submission.scores[judgeSubmissionKey][category.id] || 0;
                judgeTotal += score;
                categoryTotals[category.id] += score;
              });
            } 
            // Then check the judge's scores object as a backup
            else if (judge.scores && judge.scores[judgeSubmissionKey]) {
              hasScored = true;
              categories.forEach(category => {
                const score = judge.scores[judgeSubmissionKey][category.id] || 0;
                judgeTotal += score;
                categoryTotals[category.id] += score;
              });
            }
            
            if (hasScored) judgeCount++;
            scoresByJudge[judge.id] = judgeTotal;
            totalScore += judgeTotal;
          });

          return {
            ...submission,
            totalScore,
            scoresByJudge,
            categoryTotals,
            judgeCount
          };
        });

        return results.sort((a, b) => b.totalScore - a.totalScore);
      };

      const sortedResults = calculateResults();
      
      // Save scores for the current submission
      const handleSaveScores = () => {
        if (!currentJudge || !activeSubmissionId) return;
        
        const judgeSubmissionKey = `${currentJudge.id}-${activeSubmissionId}`;
        
        // Update judges state
        setJudges(judges.map(judge => {
          if (judge.id === currentJudge.id) {
            return {
              ...judge,
              scores: {
                ...judge.scores,
                [judgeSubmissionKey]: { ...tempScores }
              }
            };
          }
          return judge;
        }));
        
        // Update submissions with the new scores
        setSubmissions(submissions.map(submission => {
          if (submission.id === activeSubmissionId) {
            return {
              ...submission,
              scores: {
                ...submission.scores,
                [judgeSubmissionKey]: { ...tempScores }
              }
            };
          }
          return submission;
        }));
        
        // Show success message
        alert('Scores saved successfully!');
      };

      // Update temporary score for a category
      const updateTempScore = (categoryId, value) => {
        const category = categories.find(cat => cat.id === categoryId);
        const numValue = parseInt(value);
        
        // Validate the score is within bounds
        if (isNaN(numValue) || numValue < 0) {
          setTempScores({...tempScores, [categoryId]: 0});
        } else if (numValue > category.maxPoints) {
          setTempScores({...tempScores, [categoryId]: category.maxPoints});
        } else {
          setTempScores({...tempScores, [categoryId]: numValue});
        }
      };

      // Load existing scores when changing submissions
      React.useEffect(() => {
        if (currentJudge && activeSubmissionId) {
          const judgeSubmissionKey = `${currentJudge.id}-${activeSubmissionId}`;
          
          // First look in the submission's scores
          const submission = submissions.find(s => s.id === activeSubmissionId);
          if (submission && submission.scores && submission.scores[judgeSubmissionKey]) {
            setTempScores(submission.scores[judgeSubmissionKey]);
          } 
          // Then look in the judge's scores as a backup
          else if (currentJudge.scores && currentJudge.scores[judgeSubmissionKey]) {
            setTempScores(currentJudge.scores[judgeSubmissionKey]);
          } else {
            setTempScores({});
          }
        } else {
          setTempScores({});
        }
      }, [activeSubmissionId, currentJudge, submissions]);
      
      // Render admin dashboard
      const renderAdminDashboard = () => (
        <div className="max-w-4xl mx-auto">
          <div className="bg-white p-6 rounded-lg shadow mb-6">
            <h2 className="text-2xl font-bold mb-4">Administrator Dashboard</h2>
            <p className="mb-4 text-gray-700">Use this page to manage the visualization contest application.</p>
            
            {appInitialized ? (
              <div className="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                <span className="font-bold">Application initialized!</span> The application is ready to use with {submissions.length} submissions loaded.
              </div>
            ) : (
              <div className="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4">
                <span className="font-bold">Setup needed:</span> Please upload your submission data to initialize the application.
              </div>
            )}
            
            <div className="mb-6">
              <h3 className="text-lg font-bold mb-2">Upload Submissions Data</h3>
              <p className="mb-2 text-gray-700">Upload your Google Sheets data as a CSV file to load submissions.</p>
              
              <div className="mb-4">
                <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="csv-file">
                  Select CSV File
                </label>
                <input
                  type="file"
                  id="csv-file"
                  accept=".csv"
                  onChange={handleFileUpload}
                  className="p-2 border rounded"
                />
              </div>
            </div>
            
            {appInitialized && (
              <div className="mb-6">
                <h3 className="text-lg font-bold mb-2">Share with Judges</h3>
                <p className="mb-2 text-gray-700">Send this link to judges so they can access the application:</p>
                
                <div className="flex mb-2">
                  <input
                    type="text"
                    value={sharingLink || window.location.href.split('?')[0]}
                    readOnly
                    className="w-full p-2 border rounded-l"
                  />
                  <button
                    onClick={() => {
                      navigator.clipboard.writeText(sharingLink || window.location.href.split('?')[0]);
                      alert("Link copied to clipboard!");
                    }}
                    className="bg-blue-500 hover:bg-blue-600 text-white px-4 rounded-r"
                  >
                    Copy
                  </button>
                </div>
                
                <p className="text-sm text-gray-600">
                  This link will allow judges to access the application with the uploaded data.
                </p>
              </div>
            )}
            
            {appInitialized && (
              <div className="mb-6">
                <h3 className="text-lg font-bold mb-2">Administrator Access</h3>
                <p className="mb-2 text-gray-700">Use this link to access the admin dashboard in the future:</p>
                
                <div className="flex mb-2">
                  <input
                    type="text"
                    value={adminLink || `${window.location.href.split('?')[0]}?admin=setupadmin`}
                    readOnly
                    className="w-full p-2 border rounded-l"
                  />
                  <button
                    onClick={() => {
                      navigator.clipboard.writeText(adminLink || `${window.location.href.split('?')[0]}?admin=setupadmin`);
                      alert("Admin link copied to clipboard!");
                    }}
                    className="bg-blue-500 hover:bg-blue-600 text-white px-4 rounded-r"
                  >
                    Copy
                  </button>
                </div>
                
                <p className="text-sm text-gray-600">
                  Save this link to access administrator functions. Keep it secure!
                </p>
              </div>
            )}
            
            <div className="flex space-x-4">
              <button
                onClick={() => setView('login')}
                className="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded"
              >
                Go to Judge Login
              </button>
              
              {appInitialized && (
                <button
                  onClick={() => setView('results')}
                  className="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded"
                >
                  View Results
                </button>
              )}
              
              {appInitialized && (
                <button
                  onClick={resetAppData}
                  className="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded"
                >
                  Reset Application
                </button>
              )}
            </div>
          </div>
          
          {appInitialized && (
            <div className="bg-white p-6 rounded-lg shadow">
              <h3 className="text-lg font-bold mb-4">Loaded Submissions ({submissions.length})</h3>
              <div className="overflow-auto max-h-96">
                {submissions.map(submission => (
                  <div key={submission.id} className="p-3 border-b last:border-b-0">
                    <div className="flex justify-between">
                      <h4 className="font-bold">{submission.number}</h4>
                      <span className="text-gray-500">{submission.medium}</span>
                    </div>
                    <p className="text-sm my-1 text-gray-700">{submission.description.substring(0, 100)}...</p>
                    <a href={submission.link} target="_blank" rel="noopener noreferrer" className="text-blue-500 text-sm">
                      {submission.link}
                    </a>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      );

      // Login view
      const renderLoginView = () => (
        <div className="p-6 max-w-md mx-auto bg-white rounded-xl shadow-md">
          <h2 className="text-xl font-bold mb-4">Select Your Judge Name</h2>
          <div className="grid grid-cols-2 gap-3">
            {judges.map(judge => (
              <button
                key={judge.id}
                onClick={() => {
                  setCurrentJudge(judge);
                  setView('judging');
                }}
                className="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded"
              >
                {judge.name}
              </button>
            ))}
          </div>
        </div>
      );

      // Judging view
      const renderJudgingView = () => (
        <div className="max-w-6xl mx-auto">
          <div className="flex justify-between items-center mb-6 p-4 bg-white rounded-lg shadow">
            <h2 className="text-2xl font-bold">Visualization Contest Judging</h2>
            <div className="flex items-center space-x-4">
              <span className="font-medium">Logged in as: {currentJudge?.name}</span>
              <button 
                onClick={() => setView('results')}
                className="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded"
              >
                View Results
              </button>
              <button 
                onClick={() => setCurrentJudge(null) & setView('login')}
                className="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded"
              >
                Log Out
              </button>
            </div>
          </div>

          <div className="grid md:grid-cols-2 gap-6">
            {/* Submissions list */}
            <div className="bg-white p-4 rounded-lg shadow overflow-auto max-h-screen">
              <h3 className="text-xl font-bold mb-4">Submissions</h3>
              {submissions.map(submission => {
                const judgeSubmissionKey = `${currentJudge?.id}-${submission.id}`;
                // Check both places where scores might be stored
                const hasScores = (submission.scores && submission.scores[judgeSubmissionKey]) || 
                                 (currentJudge?.scores && currentJudge?.scores[judgeSubmissionKey]);
                
                return (
                  <div 
                    key={submission.id} 
                    className={`p-4 mb-4 border rounded-lg cursor-pointer ${
                      activeSubmissionId === submission.id 
                        ? 'border-blue-500 bg-blue-50' 
                        : hasScores 
                          ? 'border-green-200 bg-green-50 hover:bg-green-100' 
                          : 'border-gray-200 hover:bg-gray-50'
                    }`}
                    onClick={() => setActiveSubmissionId(submission.id) & setIframeLoading(true)}
                  >
                    <div className="flex justify-between">
                      <h4 className="font-bold">{submission.number}</h4>
                      <span className={hasScores ? "text-green-500" : "text-gray-500"}>
                        {hasScores ? "✓ Judged" : "Not judged yet"}
                      </span>
                    </div>
                    <p className="text-sm my-2 text-gray-700">{submission.description.substring(0, 100)}...</p>
                    <span className="text-blue-500 text-sm">{submission.link}</span>
                  </div>
                );
              })}
            </div>

            {/* Submission preview and judging form */}
            <div className="space-y-6">
              {/* Preview */}
              <div className="bg-white p-4 rounded-lg shadow">
                <h3 className="text-xl font-bold mb-4">Preview</h3>
                {activeSubmissionId ? (
                  <div>
                    <div className="mb-4">
                      <h4 className="font-bold">{submissions.find(s => s.id === activeSubmissionId)?.number}</h4>
                      <p className="text-gray-700 my-2">{submissions.find(s => s.id === activeSubmissionId)?.description}</p>
                    </div>
                    
                    <div className="relative min-h-64 border rounded-lg">
                      {iframeLoading && (
                        <div className="absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg">
                          <p>Loading visualization...</p>
                        </div>
                      )}
                      <iframe 
                        src={submissions.find(s => s.id === activeSubmissionId)?.link}
                        className="w-full h-96 border-0 rounded-lg"
                        onLoad={() => setIframeLoading(false)}
                        title={`Submission ${activeSubmissionId}`}
                        sandbox="allow-scripts allow-same-origin"
                      />
                    </div>
                  </div>
                ) : (
                  <div className="flex items-center justify-center h-64 bg-gray-100 rounded-lg">
                    <p className="text-gray-500">Select a submission to preview</p>
                  </div>
                )}
              </div>
              
              {/* Judging form */}
              {activeSubmissionId && (
                <div className="bg-white p-4 rounded-lg shadow">
                  <h3 className="text-xl font-bold mb-4">Score This Submission</h3>
                  <div className="space-y-4">
                    {categories.map(category => (
                      <div key={category.id}>
                        <div className="flex items-center mb-1">
                          <label className="font-medium">{category.name} (0-{category.maxPoints}):</label>
                          <input
                            type="number"
                            min="0"
                            max={category.maxPoints}
                            value={tempScores[category.id] || 0}
                            onChange={(e) => updateTempScore(category.id, e.target.value)}
                            className="w-16 p-2 border rounded ml-2"
                          />
                        </div>
                        <div className="text-xs text-gray-500 mb-2">{category.description}</div>
                        <div className="flex items-center">
                          <span className="text-xs mr-2">0</span>
                          <input
                            type="range"
                            min="0"
                            max={category.maxPoints}
                            step="1"
                            value={tempScores[category.id] || 0}
                            onChange={(e) => updateTempScore(category.id, e.target.value)}
                            className="flex-grow"
                          />
                          <span className="text-xs ml-2">{category.maxPoints}</span>
                        </div>
                      </div>
                    ))}
                    
                    <div className="pt-4 border-t mt-6">
                      <div className="flex justify-between mb-4">
                        <span className="font-medium">Total Score:</span>
                        <span className="font-bold text-lg">{
                          Object.values(tempScores).reduce((sum, score) => sum + (score || 0), 0)
                        } / {totalPossiblePoints}</span>
                      </div>
                      <button
                        onClick={handleSaveScores}
                        className="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded"
                      >
                        Save Scores
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      );

      // Results view
      const renderResultsView = () => (
        <div className="max-w-6xl mx-auto">
          <div className="flex justify-between items-center mb-6 p-4 bg-white rounded-lg shadow">
            <h2 className="text-2xl font-bold">Contest Results</h2>
            <div className="flex items-center space-x-4">
              {currentJudge && <span className="font-medium">Logged in as: {currentJudge?.name}</span>}
              {currentJudge ? (
                <button 
                  onClick={() => setView('judging')}
                  className="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded"
                >
                  Back to Judging
                </button>
              ) : (
                <button 
                  onClick={() => setView('login')}
                  className="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded"
                >
                  Back to Login
                </button>
              )}
              {isAdmin && (
                <button 
                  onClick={() => setView('admin')}
                  className="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded"
                >
                  Admin Dashboard
                </button>
              )}
            </div>
          </div>

          <div className="bg-white p-6 rounded-lg shadow">
            <h3 className="text-xl font-bold mb-6">Current Rankings</h3>
            
            <div className="overflow-x-auto">
              <table className="min-w-full divide-y divide-gray-200">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Submission</th>
                    {categories.map(category => (
                      <th key={category.id} className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        {category.name} (/{category.maxPoints})
                      </th>
                    ))}
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Judges</th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {sortedResults.slice(0, 10).map((result, index) => (
                    <tr key={result.id} className={index < 3 ? "bg-yellow-50" : ""}>
                      <td className="px-6 py-4 whitespace-nowrap">
                        <div className="flex items-center justify-center w-8 h-8 rounded-full bg-blue-500 text-white font-bold">
                          {index + 1}
                        </div>
                      </td>
                      <td className="px-6 py-4">
                        <div className="text-sm font-medium text-gray-900">{result.number}</div>
                        <div className="text-sm text-gray-500">{result.medium}</div>
                      </td>
                      {categories.map(category => (
                        <td key={category.id} className="px-6 py-4">
                          <div className="text-sm text-gray-900 font-medium">
                            {(result.categoryTotals[category.id] || 0).toFixed(1)}
                          </div>
                          <div className="text-xs text-gray-500">
                            avg: {result.judgeCount > 0 ? ((result.categoryTotals[category.id] || 0) / result.judgeCount).toFixed(1) : 0}
                          </div>
                        </td>
                      ))}
                      <td className="px-6 py-4">
                        <div className="text-sm font-bold text-gray-900">{result.totalScore}</div>
                        <div className="text-xs text-gray-500">
                          avg: {result.judgeCount > 0 ? (result.totalScore / result.judgeCount).toFixed(1) : 0}
                        </div>
                      </td>
                      <td className="px-6 py-4">
                        <div className="text-sm text-gray-900">{result.judgeCount} / {judges.length}</div>
                      </td>
                      <td className="px-6 py-4 text-sm">
                        <button 
                          onClick={() => {
                            setActiveSubmissionId(result.id);
                            if (currentJudge) {
                              setView('judging');
                            } else {
                              // If viewing results without being logged in (e.g. as admin)
                              // just show the preview without judging capability
                              const submissionUrl = result.link;
                              window.open(submissionUrl, '_blank');
                            }
                            setIframeLoading(true);
                          }}
                          className="text-blue-500 hover:text-blue-700"
                        >
                          View
                        </button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      );

      // Render the appropriate view
      return (
        <div className="min-h-screen bg-gray-100 p-4">
          {isLoading ? (
            <div className="flex items-center justify-center h-screen">
              <div className="text-center">
                <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto"></div>
                <p className="mt-4">Loading submission data...</p>
              </div>
            </div>
          ) : (
            <>
              {view === 'admin' && renderAdminDashboard()}
              {view === 'login' && renderLoginView()}
              {view === 'judging' && renderJudgingView()}
              {view === 'results' && renderResultsView()}
            </>
          )}
        </div>
      );
    };

    // Render the application
    ReactDOM.render(<VotingApp />, document.getElementById('root'));
  </script>
</body>
</html>
